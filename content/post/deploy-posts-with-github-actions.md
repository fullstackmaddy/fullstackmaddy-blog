---
author: "Mandar Dharmadhikari"
title: "How I deploy my Hugo static website automatically with GITHUB Actions"
description : "Primer on deploying static website with GitHub Action"
date: "2021-02-15"
tags : [
    "GITHUB Actions",
    "HUGO"
]
draft : "true"
featured : true
thumbnail : "images/deploy-posts-with-github-actions/feature.PNG"
---

![](/images/deploy-posts-with-github-actions/feature.PNG)

## Some Background

I have been using Wordpress and dynamic websites in one form or another for writing articles for at least two years now. But recently I made a decision of moving away from dynamic website and adopt static website for my blog. There were few key reasons why I did this
1. I was paying money for hosting my website on one of the hosting providers.
2. The dynamic website was very cumbersome to maintain and I always disliked updating plugins every time I logged into the admin portal.
3. The website was slow to load.
4. I prefer to write my posts using Markdown language and the personally I did not like the Wordpress support for markdown files.

Hence I decided to use static website. Being really new at creating a static blogging website, I decided to use hugo platform to create my website. Hugo is a website engine written with GO language and it is a good choice because
1. It is open source so it is free to use
2. Supports inbuilt support for markdown files
3. Supports internationalization 
4. Allows us to create websites quickly as it supports custom themes which can be obtained from hugo themes page or from GITHUB. This makes the website creation really fast. Each theme has a boiler plate of sample site which we can use to set up the blog quickly.
5. We can apply lot of customization using short codes we can write our own as well.
6. We can change the themes for the website on the go by changing the themes in the config file of the website.

## Some Initial Decisions

Setting up initial website is easy, but I must state that if you want to customize it a lot, then there is some learning curve required.
You can read more about hugo at [Hugo Docs](https://gohugo.io/documentation/)

Armed with basic knowledge, I decided to set up my own website using the Hugo Clarity theme, you can download it from [Hugo Clarity](https://themes.gohugo.io/hugo-clarity/)

GITHUB allows one static website per account and it provides 1GB of space for us to host it. It is completely free and has baked in support of GITHUB Actions which allows us to setup an automation workflow to deploy our website when we push changes to the repository. Read more about [GITHUB Actions](https://docs.github.com/en/actions)

The documentation of Hugo site guides that a common practice to deploy a static website on GITHUB pages is that we create two repositories
1. A repository named `username.github.io` which will contain the assets that will be served over the website
2. Another repository to host the entire code for the website containing the static assets, themes, configs etc.

This instantly makes sense from the good old `Separation of Concerns` principle of software development.

## The Setup

I created two public repositories 


1. [fullstackmaddy/fullstackmaddy.github.io](https://github.com/fullstackmaddy/fullstackmaddy.github.io) : To host the assets of the website.
2. [fullstackmaddy/fullstackmaddy-blog](https://github.com/fullstackmaddy/fullstackmaddy-blog) : To contain the code.

Once we go to the settings, we can see that Github recognizes the `username.github.io` and gives the locations from which the assets will be served when some visits `https://<username>.github.io`

![GitHub Page Settings](/images/deploy-posts-with-github-actions/githubpagessettings.PNG)

I have used following actions from GITHUB marketplace.
1. `peaceiris/actions-hugo@v2` more [here](https://github.com/peaceiris/actions-hugo) : This action helps us build the website using the hugo command and help generate the static content which ultimately needs to be pushed to the website repository
2. `peaceiris/actions-gh-pages@v3` more [here](https://github.com/peaceiris/actions-gh-pages) : This helps us push the content built by hugo to the target repository.

To allow deployment of content generated by step 1, there are three options 
1. Create a GITHUB token which allows the push
2. Create a personal token
3. Create public private pair of deployment keys and set them.

I chose the third option as it allows more granularity on what is shared between the repositories.
To generate the keys following command needs to be run

```shell
ssh-keygen -t rsa -b 4096 -C "$(git config user.email)" -f gh-pages -N ""

```
This creates two files `gh-pages.pub` which is the public key and `gh-pages` which is the private key.

Next task is to add the `gh-pages.pub` key as the deploy key with `write` access in the destination repository (username.github.io). It can done as shown below

![Configure the public key on username.github.io](/images/deploy-posts-with-github-actions/configurepublickey.PNG)

Next task is to add the private key as the secret on the source repository. Following figure shows how to do that.

![Configure the private key on source repository](/images/deploy-posts-with-github-actions/configureprivatekey.PNG)

This completed the basic setup and I created the GITHUB action which is discussed below. (I have assumed that you have some prior knowledge about concepts and terminology of GITHUB actions. If not please head to [GITHUB Actions](https://docs.github.com/en/actions) )

## GITHUB Action


I will now break down each component of the flow. 

### Trigger

The workflow is triggered when there is a push to the master branch of the source repository. The snippet looks like

```yaml
on:
  push:
    branches:
      - "main"

```
So whenever a push is made on the `main` branch, the workflow runs subsequent steps.

Next step is to specify where the jobs will be run, I have chosen ubuntu-latest as the platform where the tasks will be run. The first task is to check out the main branch of the repository it is dune using the `actions/checkout@v2` . It is done as 

```yaml
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:

    # Checkout the code
    - name: Checkout the code
      uses: actions/checkout@v2

```

Once this is done,  hugo is setup and the hugo build action is run so that the assets for the static website are created. It is done as following

```yaml

    # Setup Hugo
    - name: Set up Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: 'latest'
        extended: true
    
    #Build
    - name: Build Static Website
      run: hugo

```

And as the final step, the created assets are pushed to the destination repository. It is configured as below.

```yaml

# Deploy the website

- name: Deploy Static Website
      uses: peaceiris/actions-gh-pages@v3
      with: 
       deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
       external_repository: fullstackmaddy/fullstackmaddy.github.io
       publish_branch: main
       publish_dir: ./public
       user_name: 'github-actions[bot]'
       user_email: 'github-actions[bot]@users.noreply.github.com'
       full_commit_message: ${{ github.event.head_commit.message }}

```

The final workflow looks like following

```yaml

name: Deploy-FullStackMaddy-Website

on:
  push:
    branches:
      - "main"

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:

    # Checkout the code
    - name: Checkout the code
      uses: actions/checkout@v2
    
    # Setup Hugo
    - name: Set up Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: 'latest'
        extended: true
    
    #Build
    - name: Build Static Website
      run: hugo

    - name: Deploy Static Website
      uses: peaceiris/actions-gh-pages@v3
      with: 
       deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
       external_repository: fullstackmaddy/fullstackmaddy.github.io
       publish_branch: main
       publish_dir: ./public
       user_name: 'github-actions[bot]'
       user_email: 'github-actions[bot]@users.noreply.github.com'
       full_commit_message: ${{ github.event.head_commit.message }}

```
I have also added a badge on the README.md file of the source repository so that any point I know that my workflow is working properly or not. The typical badge looks like following.

![Deployment badge](/images/deploy-posts-with-github-actions/deploymentbadge.PNG)

The messages and the commits made by the bot are available for inspection

![Action Bot records comments](/images/deploy-posts-with-github-actions/githubactionsbot.PNG)

And that is it, this takes care of the deployment of the new blog posts to my website.

## Possible Improvement

I am thinking of adding tags to my commits and change my workflow to trigger on only specific tags.

PS: This post is also automatically deployed.